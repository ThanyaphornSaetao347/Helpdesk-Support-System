<!-- My Profile Page -->
<div class="profile-container">
  <h1 class="page-title">My Profile</h1>

  <!-- Profile Header with Avatar -->
  <div class="profile-header">
    <div class="profile-pic">{{ getUserInitial() }}</div>
    <div class="profile-info">
      <h2 class="profile-name">{{ userInfo.fullName }}</h2>
      <div class="profile-role">{{ userInfo.role }}</div>
      <button class="btn-change-photo" (click)="onChangePhoto()">Change Photo</button>
    </div>
  </div>

  <!-- Profile Form -->
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="profile-form">
    
    <!-- Basic Information Section -->
    <div class="profile-section">
      <h3 class="section-title">Basic Information</h3>
      
      <div class="form-grid">
        <!-- First Name -->
        <div class="form-group">
          <label class="form-label" for="firstname">
            First Name <span class="required">*</span>
          </label>
          <input
            id="firstname"
            type="text"
            class="form-input"
            formControlName="firstname"
            placeholder="Enter first name"
            [class.error]="isFieldInvalid('firstname')"
            [disabled]="isSubmitting"
            autocomplete="given-name"
          />
          <div class="error-message" *ngIf="isFieldInvalid('firstname')">
            {{ getFieldError('firstname') }}
          </div>
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label class="form-label" for="lastname">
            Last Name <span class="required">*</span>
          </label>
          <input
            id="lastname"
            type="text"
            class="form-input"
            formControlName="lastname"
            placeholder="Enter last name"
            [class.error]="isFieldInvalid('lastname')"
            [disabled]="isSubmitting"
            autocomplete="family-name"
          />
          <div class="error-message" *ngIf="isFieldInvalid('lastname')">
            {{ getFieldError('lastname') }}
          </div>
        </div>

        <!-- Username (Read-only) -->
        <div class="form-group">
          <label class="form-label" for="username">
            Username
          </label>
          <input
            id="username"
            type="text"
            class="form-input"
            formControlName="username"
            [disabled]="true"
            autocomplete="username"
          />
          <small class="form-hint">Username cannot be changed</small>
        </div>

        <!-- Email -->
        <div class="form-group">
          <label class="form-label" for="email">
            Email Address <span class="required">*</span>
          </label>
          <input
            id="email"
            type="email"
            class="form-input"
            formControlName="email"
            placeholder="Enter email address"
            [class.error]="isFieldInvalid('email')"
            [disabled]="isSubmitting"
            autocomplete="email"
          />
          <div class="error-message" *ngIf="isFieldInvalid('email')">
            {{ getFieldError('email') }}
          </div>
        </div>

        <!-- Phone -->
        <div class="form-group">
          <label class="form-label" for="phone">
            Phone Number <span class="required">*</span>
          </label>
          <input
            id="phone"
            type="tel"
            class="form-input"
            formControlName="phone"
            placeholder="Enter phone number"
            [class.error]="isFieldInvalid('phone')"
            [disabled]="isSubmitting"
            autocomplete="tel"
          />
          <div class="error-message" *ngIf="isFieldInvalid('phone')">
            {{ getFieldError('phone') }}
          </div>
        </div>

        <!-- Role Display (Read-only) -->
        <div class="form-group">
          <label class="form-label">Role</label>
          <div class="role-display">
            <span class="role-badge">{{ userInfo.role }}</span>
          </div>
          <small class="form-hint">Your role is assigned by administrator</small>
        </div>
      </div>
    </div>

    <!-- Password Management Section -->
    <div class="profile-section">
      <h3 class="section-title">Password Management</h3>
      <p class="section-description">Leave password fields blank to keep your current password</p>
      
      <div class="form-grid">
        <!-- Current Password -->
        <div class="form-group">
          <label class="form-label" for="currentPassword">
            Current Password
          </label>
          <input
            id="currentPassword"
            type="password"
            class="form-input"
            formControlName="currentPassword"
            placeholder="Enter current password"
            [class.error]="isFieldInvalid('currentPassword')"
            [disabled]="isSubmitting"
            autocomplete="current-password"
          />
          <div class="error-message" *ngIf="isFieldInvalid('currentPassword')">
            {{ getFieldError('currentPassword') }}
          </div>
        </div>

        <div></div> <!-- Empty cell for grid alignment -->

        <!-- New Password -->
        <div class="form-group">
          <label class="form-label" for="newPassword">
            New Password
          </label>
          <input
            id="newPassword"
            type="password"
            class="form-input"
            formControlName="newPassword"
            placeholder="Enter new password"
            [class.error]="isFieldInvalid('newPassword')"
            [disabled]="isSubmitting"
            autocomplete="new-password"
          />
          <div class="error-message" *ngIf="isFieldInvalid('newPassword')">
            {{ getFieldError('newPassword') }}
          </div>
          <small class="form-hint">Minimum 8 characters</small>
        </div>

        <!-- Confirm New Password -->
        <div class="form-group">
          <label class="form-label" for="confirmPassword">
            Confirm New Password
          </label>
          <input
            id="confirmPassword"
            type="password"
            class="form-input"
            formControlName="confirmPassword"
            placeholder="Confirm new password"
            [class.error]="isFieldInvalid('confirmPassword')"
            [disabled]="isSubmitting"
            autocomplete="new-password"
          />
          <div class="error-message" *ngIf="isFieldInvalid('confirmPassword')">
            {{ getFieldError('confirmPassword') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="form-actions">
      <button type="submit" 
              class="btn-save" 
              [disabled]="userForm.invalid || isSubmitting">
        <span *ngIf="isSubmitting" class="loading-spinner"></span>
        {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
      </button>
    </div>
  </form>
</div>

<!-- Notification Display -->
<div class="notification" *ngIf="notification" [class]="'notification-' + notification.type">
  <div class="notification-content">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="notification-icon">
      <!-- Success Icon -->
      <path *ngIf="notification.type === 'success'" d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm3.78-9.72a.75.75 0 0 0-1.06-1.06L6.75 9.19 5.28 7.72a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l4.5-4.5z"/>
      <!-- Error Icon -->
      <path *ngIf="notification.type === 'error'" d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
      <!-- Warning Icon -->
      <path *ngIf="notification.type === 'warning'" d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
      <!-- Info Icon -->
      <path *ngIf="notification.type === 'info'" d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
    </svg>
    <span>{{ notification.message }}</span>
    <button class="notification-close" (click)="clearNotification()">
      <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
        <path d="M.293.293a1 1 0 0 1 1.414 0L6 4.586 10.293.293a1 1 0 1 1 1.414 1.414L7.414 6l4.293 4.293a1 1 0 0 1-1.414 1.414L6 7.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L5.586 6 1.293 1.707a1 1 0 0 1 0-1.414z"/>
      </svg>
    </button>
  </div>
</div>