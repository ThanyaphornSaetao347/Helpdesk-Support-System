<!-- src/app/pages/dashboard/dashboard.component.html -->

<div class="dashboard">
  <!-- Breadcrumb -->
  <div class="breadcrumb-container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#" routerLink="/dashboard">{{ translate('menu.dashboard') }}</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ translate('dashboard.title') }}</li>
      </ol>
    </nav>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ translate('common.loading') }}</span>
    </div>
    <p class="mt-2 text-muted">{{ translate('common.loading') }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="dashboardData.error" class="alert alert-warning" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ dashboardData.error }}
  </div>

  <!-- Dashboard Header Card -->
  <div class="dashboard-header-card">
    <h1>{{ translate('dashboard.title') }}</h1>

    <!-- Stats Cards Row -->
    <div class="d-flex justify-content-between align-items-center gap-4">
      <!-- Total Ticket -->
      <div class="stats-card bg-primary">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-ticket-perforated stats-icon" style="color: #5873F8;"></i>
          </div>
          <div class="stats-text-container">
            <p>{{ translate('dashboard.totalTickets') }}</p>
            <h4>{{ formatNumber(dashboardStats?.total || 0) }}</h4>
          </div>
        </div>
      </div>

      <!-- New Ticket -->
      <div class="stats-card bg-warning">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-plus-circle stats-icon" style="color: #FFC107;"></i>
          </div>
          <div class="stats-text-container">
            <p>{{ translate('dashboard.newTickets') }}</p>
            <h4>{{ formatNumber(getNewCount()) }}</h4>
          </div>
        </div>
      </div>

      <!-- In Progress -->
      <div class="stats-card bg-info">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-chat stats-icon" style="color: #1FBCD5;"></i>
          </div>
          <div class="stats-text-container">
            <p>{{ translate('dashboard.inProgress') }}</p>
            <h4>{{ formatNumber(getInProgressCount()) }}</h4>
          </div>
        </div>
      </div>

      <!-- Complete -->
      <div class="stats-card bg-success">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-check-circle stats-icon" style="color: #28A745;"></i>
          </div>
          <div class="stats-text-container">
            <p>{{ translate('dashboard.completed') }}</p>
            <h4>{{ formatNumber(getCompleteCount()) }}</h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Line Chart -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow">
        <div class="card-header py-3">
          <div class="d-flex justify-content-between align-items-center w-100">
            <h6 class="m-0 font-weight-bold text-primary">{{ translate('dashboard.allTicketsAtMonth') }}</h6>
            <div class="chart-controls">
              <div class="d-flex gap-2">
                <!-- Month Dropdown -->
                <div class="dropdown">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="monthDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ getDisplayMonthName(selectedMonth) }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="monthDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('January')">{{ getMonthName(1) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('February')">{{ getMonthName(2) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('March')">{{ getMonthName(3) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('April')">{{ getMonthName(4) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('May')">{{ getMonthName(5) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('June')">{{ getMonthName(6) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('July')">{{ getMonthName(7) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('August')">{{ getMonthName(8) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('September')">{{ getMonthName(9) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('October')">{{ getMonthName(10) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('November')">{{ getMonthName(11) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('December')">{{ getMonthName(12) }}</a></li>
                  </ul>
                </div>
                <!-- Year Dropdown -->
                <div class="dropdown ms-2">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="yearDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ selectedYear }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="yearDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectYear('2023')">2023</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectYear('2024')">2024</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectYear('2025')">2025</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-area">
            <canvas #monthlyChart id="monthlyChart" style="height: 400px;"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bar Chart -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow">
        <div class="card-header py-3">
          <div class="d-flex justify-content-between align-items-center w-100">
            <h6 class="m-0 font-weight-bold text-primary">{{ translate('dashboard.monthlyBarChart') }}</h6>
            <div class="chart-controls">
              <div class="d-flex gap-2">
                <!-- Month Dropdown for Bar Chart -->
                <div class="dropdown">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="barMonthDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ getDisplayMonthName(selectedBarMonth) }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="barMonthDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('January')">{{ getMonthName(1) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('February')">{{ getMonthName(2) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('March')">{{ getMonthName(3) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('April')">{{ getMonthName(4) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('May')">{{ getMonthName(5) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('June')">{{ getMonthName(6) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('July')">{{ getMonthName(7) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('August')">{{ getMonthName(8) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('September')">{{ getMonthName(9) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('October')">{{ getMonthName(10) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('November')">{{ getMonthName(11) }}</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('December')">{{ getMonthName(12) }}</a></li>
                  </ul>
                </div>

                <!-- Year Dropdown for Bar Chart -->
                <div class="dropdown ms-2">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="barYearDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ selectedBarYear }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="barYearDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarYear('2023')">2023</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarYear('2024')">2024</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarYear('2025')">2025</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="chart-area">
            <canvas #monthlybarChart id="monthlybarChart" style="height: 400px;"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Categories Chart -->
  <div class="row">
    <!-- All Ticket Summary by Categories Chart -->
    <div class="col-md-8 mb-4">
      <div class="card chart-card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center w-100">
            <h5 class="card-title">{{ translate('dashboard.ticketSummaryByCategories') }}</h5>
            <div class="dropdown">
              <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <span>{{ selectedCategoryYear }}</span>
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectCategoryYear('2025')">2025</a></li>
                <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectCategoryYear('2024')">2024</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas #categoryChart id="categoryChart" width="600" height="165"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Ticket Summary by Categories Pie Chart -->
    <div class="col-md-4 mb-4">
      <div class="card chart-card">
        <div class="card-header">
          <div class="text-center w-100">
            <h5 class="card-title">{{ translate('dashboard.categorySummary') }}</h5>
          </div>
        </div>
        <div class="card-body text-center">
          <div class="chart-container d-flex justify-content-center align-items-center">
            <canvas #pieChart id="pieChart" width="204" height="204"></canvas>
          </div>
          <!-- Dynamic Legend -->
          <div class="pie-legend" *ngIf="categoryStats.length > 0">
            <div class="pie-legend-column" *ngFor="let column of getCategoryColumns(); let isFirst = first">
              <span class="legend-item" *ngFor="let item of column">
                <span class="legend-color" [style.background-color]="item.color"></span>
                {{ item.category }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>