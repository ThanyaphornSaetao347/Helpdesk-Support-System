<!-- src/app/pages/dashboard/dashboard.component.html -->

<div class="dashboard">
  <!-- Breadcrumb - ตรงกับ Figma -->
  <div class="breadcrumb-container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="#" routerLink="/dashboard">Dashboard</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
      </ol>
    </nav>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2 text-muted">กำลังโหลดข้อมูล...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="dashboardData.error" class="alert alert-warning" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>
    {{ dashboardData.error }}
  </div>

  <!-- Dashboard Header Card - ตรงกับ Figma -->
  <div class="dashboard-header-card">
    <h1>Dashboard</h1>

    <!-- Stats Cards Row -->
    <div class="d-flex justify-content-between align-items-center gap-4">
      <!-- Total Ticket -->
      <div class="stats-card bg-primary">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-ticket-perforated stats-icon" style="color: #5873F8;"></i>
          </div>
          <div class="stats-text-container">
            <p>Total Ticket</p>
            <h4>{{ formatNumber(dashboardStats?.total || 0) }}</h4>
          </div>
        </div>
      </div>

      <!-- New Ticket -->
      <div class="stats-card bg-warning">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-plus-circle stats-icon" style="color: #FFC107;"></i>
          </div>
          <div class="stats-text-container">
            <p>New Ticket</p>
            <h4>{{ formatNumber(getNewCount()) }}</h4>
          </div>
        </div>
      </div>

      <!-- In Progress -->
      <div class="stats-card bg-info">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-chat stats-icon" style="color: #1FBCD5;"></i>
          </div>
          <div class="stats-text-container">
            <p>In Progress</p>
            <h4>{{ formatNumber(getInProgressCount()) }}</h4>
          </div>
        </div>
      </div>

      <!-- Complete -->
      <div class="stats-card bg-success">
        <div class="card-body">
          <div class="stats-icon-container">
            <i class="bi bi-check-circle stats-icon" style="color: #28A745;"></i>
          </div>
          <div class="stats-text-container">
            <p>Complete</p>
            <h4>{{ formatNumber(getCompleteCount()) }}</h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- line chart -->
  <!-- Charts Section -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow">
        <div class="card-header py-3">
          <div class="d-flex justify-content-between align-items-center w-100">
            <h6 class="m-0 font-weight-bold text-primary">All Tickets at Month</h6>
            <div class="chart-controls">
              <div class="d-flex gap-2">
                <div class="dropdown">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="monthDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ selectedMonth }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="monthDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('January')">มกราคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectMonth('February')">กุมภาพันธ์</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('March')">มีนาคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('April')">เมษายน</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('May')">พฤษภาคม</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('June')">มิถุนายน</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('July')">กรกฎาคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('August')">สิงหาคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectMonth('September')">กันยายน</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('October')">ตุลาคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectMonth('November')">พฤศจิกายน</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectMonth('December')">ธันวาคม</a>
                    </li>
                  </ul>
                </div>
                <div class="dropdown ms-2">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="yearDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ selectedYear }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="yearDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectYear('2023')">2023</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectYear('2024')">2024</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectYear('2025')">2025</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-area">
            <canvas #monthlyChart id="monthlyChart" style="height: 400px;"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- bar chart -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow">
        <div class="card-header py-3">
          <div class="d-flex justify-content-between align-items-center w-100">
            <h6 class="m-0 font-weight-bold text-primary">All Tickets at Month Bar Chart</h6>
            <div class="chart-controls">
              <div class="d-flex gap-2">
                <!-- Month dropdown สำหรับ Bar Chart -->
                <div class="dropdown">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="barMonthDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ selectedBarMonth }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="barMonthDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectBarMonth('January')">มกราคม</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectBarMonth('February')">กุมภาพันธ์</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('March')">มีนาคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('April')">เมษายน</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('May')">พฤษภาคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('June')">มิถุนายน</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarMonth('July')">กรกฎาคม</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectBarMonth('August')">สิงหาคม</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectBarMonth('September')">กันยายน</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectBarMonth('October')">ตุลาคม</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectBarMonth('November')">พฤศจิกายน</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)"
                        (click)="selectBarMonth('December')">ธันวาคม</a></li>
                  </ul>
                </div>

                <!-- Year dropdown สำหรับ Bar Chart -->
                <div class="dropdown ms-2">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="barYearDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <span>{{ selectedBarYear }}</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="barYearDropdown">
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarYear('2023')">2023</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarYear('2024')">2024</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectBarYear('2025')">2025</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart area -->
        <div class="card-body">
          <div class="chart-area">
            <canvas #monthlybarChart id="monthlybarChart" style="height: 400px;"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- categories chart -->
  <div class="row">
    <!-- All Ticket Summary by Categories Chart -->
    <div class="col-md-8 mb-4">
      <div class="card chart-card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center w-100">
            <h5 class="card-title">All Ticket Summary by Categories</h5>
            <div class="dropdown">
              <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <span>{{ selectedCategoryYear }}</span>
                <!-- <i class="bi bi-chevron-down ms-2"></i> -->
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectCategoryYear('2025')">2025</a></li>
                <li><a class="dropdown-item" href="javascript:void(0)" (click)="selectCategoryYear('2024')">2024</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas #categoryChart id="categoryChart" width="600" height="165"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Ticket Summary by Categories Pie Chart -->
    <div class="col-md-4 mb-4">
      <div class="card chart-card">
        <div class="card-header">
          <div class="text-center w-100">
            <h5 class="card-title">Ticket Summary by Categories</h5>
          </div>
        </div>
        <div class="card-body text-center">
          <div class="chart-container d-flex justify-content-center align-items-center">
            <canvas #pieChart id="pieChart" width="204" height="204"></canvas>
          </div>
          <!-- Dynamic Legend จากข้อมูล API -->
          <div class="pie-legend" *ngIf="categoryStats.length > 0">
            <div class="pie-legend-column" *ngFor="let column of getCategoryColumns(); let isFirst = first">
              <span class="legend-item" *ngFor="let item of column">
                <span class="legend-color" [style.background-color]="item.color"></span>
                {{ item.category }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>