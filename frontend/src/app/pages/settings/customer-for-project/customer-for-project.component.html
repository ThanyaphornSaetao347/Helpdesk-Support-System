<!-- Breadcrumb -->
<div class="breadcrumb">
  <span class="breadcrumb-item inactive">Settings</span>
  <svg class="breadcrumb-separator" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
    <path d="M6.5 3L11 8l-4.5 5" />
  </svg>
  <span class="breadcrumb-item active">Project Customers</span>
</div>

<!-- Project Selector Section -->
<div class="customer-selector-section">
  <div class="selector-header">
    <div>
      <h2 class="selector-title">Select Project</h2>
      <p class="selector-subtitle">Choose a project to manage its customers</p>
    </div>
  </div>

  <div class="customer-search-bar">
    <div class="search-input-large">
      <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path d="M7.333 12.667A5.333 5.333 0 1 0 7.333 2a5.333 5.333 0 0 0 0 10.667ZM14 14l-2.9-2.9" stroke="#9CA3AF"
          stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      <input type="text" placeholder="Search projects..." [(ngModel)]="projectSearchTerm"
        (input)="onProjectSearchChange()">
    </div>
    <select class="customer-dropdown" [(ngModel)]="selectedStatusFilter" (change)="onStatusFilterChange()">
      <option *ngFor="let option of statusOptions" [value]="option.value">
        {{ option.label }}
      </option>
    </select>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>Loading projects...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="hasError && !isLoading">
    <div class="error-icon">
      <svg width="32" height="32" viewBox="0 0 32 32" fill="#DC3545">
        <path d="M16 3L3 16l13 13 13-13L16 3zm0 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm2-6h-4v-8h4v8z" />
      </svg>
    </div>
    <h3>Error Loading Projects</h3>
    <p>{{ errorMessage }}</p>
    <button class="retry-button" (click)="loadCFPData()">Try Again</button>
  </div>

  <!-- Project Grid -->
  <div class="customer-grid" *ngIf="!isLoading && !hasError">
    <div class="customer-card" *ngFor="let project of filteredProjects; trackBy: trackByProjectId"
      (click)="navigateToProjectDetail(project)">
      <div class="card-header">
        <div class="card-avatar" [style.background]="project.status === 'active' ? '#6366F1' : '#8B5CF6'">
          {{ getProjectAvatarLetter(project.name) }}
        </div>
        <div class="card-info">
          <h3>{{ project.name }}</h3>
          <div class="card-tier" [ngClass]="getStatusBadgeClass(project.status)">
            <svg width="8" height="8" viewBox="0 0 8 8" fill="currentColor" style="margin-right: 4px;">
              <circle cx="4" cy="4" r="3" />
            </svg>
            {{ project.status | titlecase }}
          </div>
        </div>
      </div>
      <div class="card-contact">{{ project.description || 'No description' }}</div>
      <div class="card-stats">
        <div class="stat-item">
          <div class="stat-number">{{ project.total_customers || 0 }}</div>
          <div class="stat-label">Customers</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ project.total_users || 0 }}</div>
          <div class="stat-label">Users</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ project.total_open_tickets || 0 }}</div>
          <div class="stat-label">Tickets</div>
        </div>
      </div>

      <!-- View Details Button -->
      <div class="card-actions">
        <button class="btn btn-view-details" (click)="navigateToProjectDetail(project); $event.stopPropagation()">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
            <path
              d="M7 4.667a2.333 2.333 0 1 0 0 4.666 2.333 2.333 0 0 0 0-4.666zM7 2C4.333 2 2.067 3.733 1 7c1.067 3.267 3.333 5 6 5s4.933-1.733 6-5c-1.067-3.267-3.333-5-6-5z" />
          </svg>
          View Details
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!isLoading && !hasError && filteredProjects.length === 0">
    <div class="empty-icon">
      <svg width="32" height="32" viewBox="0 0 32 32" fill="#ADB5BD">
        <path
          d="M16 4C9.373 4 4 9.373 4 16s5.373 12 12 12 12-5.373 12-12S22.627 4 16 4zm0 18c-3.314 0-6-2.686-6-6s2.686-6 6-6 6 2.686 6 6-2.686 6-6 6z" />
      </svg>
    </div>
    <h3>No projects found</h3>
    <p>Try adjusting your search criteria or filters</p>
  </div>
</div>

<!-- Info Section -->
<!-- <div class="info-section" *ngIf="!isLoading && !hasError && filteredProjects.length > 0">
  <div class="info-card">
    <div class="info-icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="#6366F1">
        <path
          d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
      </svg>
    </div>
    <div class="info-content">
      <h3>How to manage project customers</h3>
      <p>Click on any project card to view and manage its customers, assign new customers, and control user access.</p>
    </div>
  </div>
</div> -->

<!-- Quick Stats Section -->
<!-- <div class="quick-stats-section" *ngIf="!isLoading && !hasError && projects.length > 0">
  <h3 class="stats-title">Overview</h3>
  <div class="stats-grid-overview">
    <div class="stat-card-overview">
      <div class="stat-icon" style="background: #EEF2FF;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#6366F1">
          <path
            d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
        </svg>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ projects.length }}</div>
        <div class="stat-label">Total Projects</div>
      </div>
    </div>

    <div class="stat-card-overview">
      <div class="stat-icon" style="background: #D1FAE5;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#10B981">
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
        </svg>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ getTotalCustomers() }}</div>
        <div class="stat-label">Total Customers</div>
      </div>
    </div>

    <div class="stat-card-overview">
      <div class="stat-icon" style="background: #E0E7FF;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#6366F1">
          <path
            d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
        </svg>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ getTotalUsers() }}</div>
        <div class="stat-label">Total Users</div>
      </div>
    </div>

    <div class="stat-card-overview">
      <div class="stat-icon" style="background: #FEE2E2;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#EF4444">
          <path
            d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z" />
        </svg>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ getTotalOpenTickets() }}</div>
        <div class="stat-label">Open Tickets</div>
      </div>
    </div>
  </div>
</div> -->